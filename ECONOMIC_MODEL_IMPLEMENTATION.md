# Реализация экономической модели в Agent Network Visualizer v2.1

## Обзор

Успешно добавлена полнофункциональная экономическая модель с клановой системой и конфликтной механикой в Agent Network Visualizer.

## Реализованные компоненты

### 1. Базовая экономическая система (`src/lib/economicEngine.js`)

**Класс:** `EconomicEngine`

**Основные функции:**
- `initializeAgentEconomics(agents)` - инициализация экономических данных для агентов
- `calculateProduction(agent, connectionMatrix, agentIndex)` - расчет производства ресурсов
- `calculateConsumption(agent)` - расчет потребления ресурсов
- `runEconomicCycle(agents, connectionMatrix)` - выполнение полного экономического цикла

**Параметры:**
- `baseProductivity` (по умолчанию: 10) - базовое производство ресурсов
- `minSurvival` (по умолчанию: 10) - минимум для выживания
- `maxMultiplier` (по умолчанию: 2.0) - максимальный множитель от связей
- `strongConnectionThreshold` (по умолчанию: 0.3) - порог сильной связи
- `connectionBonus` (по умолчанию: 0.1) - бонус от одной связи

**Механика:**
- Агенты производят ресурсы каждый экономический цикл
- Производство увеличивается при наличии сильных связей (>= threshold)
- Формула: `production = baseProductivity * (1 + min(strongConnections * connectionBonus, maxMultiplier - 1))`
- Каждый цикл агенты потребляют `minSurvival` ресурсов
- Агенты без достаточных ресурсов погибают (`alive = false`)

### 2. Система кланов (`src/lib/clanSystem.js`)

**Класс:** `ClanSystem`

**Основные функции:**
- `detectClans(agents)` - обнаружение кланов на основе плотности связей
- `calculateClanStrength(clan, agents)` - расчет силы клана
- `voteOnDistributionRule(clan, agents)` - голосование за правила распределения
- `applyDistributionRule(clan, agents, rule)` - применение правил распределения

**Параметры:**
- `minClanSize` (по умолчанию: 3) - минимальный размер клана
- `densityThreshold` (по умолчанию: 0.5) - порог плотности связей

**Правила распределения ресурсов:**

1. **Диктатура (`dictatorship`)** - сильнейший забирает все
   - Самый сильный агент получает все накопленные ресурсы клана
   
2. **Демократия (`democracy`)** - равное распределение
   - Все агенты получают равную долю накопленных ресурсов
   
3. **Баланс сил (`power_balance`)** - пропорционально силе
   - Распределение пропорционально силе каждого агента
   
4. **Беспредел (`lawlessness`)** - атака на слабейший клан
   - Инициирует конфликт с самым слабым кланом

**Механика голосования:**
- Каждый агент голосует на основе своей силы и текущих ресурсов
- Слабые агенты предпочитают демократию
- Сильные агенты предпочитают диктатуру или баланс сил
- Агрессивные кланы могут выбрать беспредел

### 3. Конфликтная механика (`src/lib/conflictMechanics.js`)

**Класс:** `ConflictMechanics`

**Основные функции:**
- `initiateConflict(attackerClan, victimClan, agents)` - инициация конфликта
- `polarizeConnections(attackerMembers, victimMembers, agents)` - поляризация связей
- `stealResources(attackerClan, victimClan, agents)` - кража ресурсов

**Параметры:**
- `polarizationFactor` (по умолчанию: 3) - фактор ослабления связей
- `resourceStealRatio` (по умолчанию: 2/3) - доля кражи накоплений

**Механика конфликтов:**
- Связи между враждующими кланами ослабляются в `polarizationFactor` раз
- Атакующий клан крадет `resourceStealRatio` накопленных ресурсов жертвы
- Украденные ресурсы распределяются пропорционально силе атакующих
- Конфликты записываются в историю для статистики

### 4. Расширенная симуляция (`src/lib/enhancedSimulation.js`)

**Функция:** `runEnhancedSimulation(config)`

**Интеграция:**
- Объединяет социальную и экономическую симуляцию
- Экономические циклы выполняются с заданным интервалом
- Обнаружение кланов и голосование каждый экономический цикл
- Применение правил распределения и конфликтов
- Сбор детальной статистики

**Параметры конфигурации:**
```javascript
{
  agents: Array,              // Массив агентов
  topics: Array,              // Массив тем
  cycles: Number,             // Количество циклов
  threshold: Number,          // Порог связей
  economicEnabled: Boolean,   // Включить экономику
  economicParams: Object,     // Параметры экономики
  clanParams: Object,         // Параметры кланов
  conflictParams: Object      // Параметры конфликтов
}
```

**Возвращаемые данные:**
```javascript
{
  agents: Array,              // Агенты с обновленными данными
  connections: Array,         // Матрица связей
  economicHistory: {
    cycles: Array,            // История экономических циклов
    clans: Array,             // История кланов
    conflicts: Array,         // История конфликтов
    deaths: Array             // История смертей
  }
}
```

### 5. UI компоненты

#### EconomicPanel (`src/components/EconomicPanel.jsx`)

**Функционал:**
- Переключатель включения/выключения экономики
- Слайдеры для настройки всех экономических параметров
- Отображение текущей экономической статистики
- Информационная подсказка о работе модели

**Отображаемая статистика:**
- Количество живых агентов
- Количество погибших агентов
- Средние ресурсы на агента
- Общее количество ресурсов в системе

#### ClanPanel (`src/components/ClanPanel.jsx`)

**Функционал:**
- Настройка параметров кланов
- Настройка параметров конфликтов
- Отображение списка текущих кланов с детальной информацией
- Статистика конфликтов
- Информационная подсказка о клановой системе

**Информация о кланах:**
- Размер клана
- Сила клана
- Плотность связей
- Общие ресурсы
- Выбранное правило распределения

**Статистика конфликтов:**
- Общее количество конфликтов
- Украдено ресурсов
- Поляризовано связей
- Самый агрессивный клан
- Самая частая жертва

### 6. Интеграция в App.jsx

**Добавленные состояния:**
```javascript
const [economicParams, setEconomicParams] = useState({...});
const [clanParams, setClanParams] = useState({...});
const [economicStats, setEconomicStats] = useState(null);
const [clanStats, setClanStats] = useState(null);
const [conflictStats, setConflictStats] = useState(null);
```

**Новые вкладки навигации:**
- "Экономика" - настройка экономической модели
- "Кланы" - настройка кланов и просмотр статистики

**Логика запуска:**
- При включенной экономике используется `runEnhancedSimulation`
- При выключенной - стандартная `runSimulation`
- Автоматический сбор и отображение статистики после симуляции

## Использование

### 1. Базовая настройка

1. Откройте вкладку "Экономика"
2. Включите переключатель "Включить экономическую модель"
3. Настройте параметры по желанию:
   - Базовая продуктивность: 5-20
   - Минимум для выживания: 5-20
   - Максимальный множитель: 1.5-3.0x
   - Порог сильной связи: 0.1-0.7
   - Бонус от связи: 5-20%
   - Интервал циклов: 3-10

### 2. Настройка кланов

1. Откройте вкладку "Кланы"
2. Настройте параметры формирования:
   - Минимальный размер клана: 2-10 агентов
   - Порог плотности связей: 0.3-0.8
3. Настройте параметры конфликтов:
   - Фактор поляризации: ÷2-÷5
   - Доля кражи накоплений: 50-100%

### 3. Запуск симуляции

1. Вернитесь на вкладку "Настройки"
2. Установите желаемые параметры (агенты, циклы и т.д.)
3. Нажмите "Запустить симуляцию"
4. Дождитесь завершения

### 4. Просмотр результатов

После завершения симуляции:

**Вкладка "Экономика":**
- Просмотрите экономическую статистику
- Проанализируйте выживаемость агентов
- Оцените распределение ресурсов

**Вкладка "Кланы":**
- Изучите сформированные кланы
- Посмотрите выбранные правила распределения
- Проанализируйте статистику конфликтов

**Вкладка "Результаты":**
- Стандартная визуализация сети
- Экспорт данных включает экономическую историю

## Примеры сценариев

### Сценарий 1: Мирное сосуществование
- Базовая продуктивность: 15
- Минимум выживания: 10
- Результат: все агенты выживают, накапливают ресурсы

### Сценарий 2: Выживание сильнейших
- Базовая продуктивность: 10
- Минимум выживания: 15
- Результат: слабосвязанные агенты погибают

### Сценарий 3: Агрессивные кланы
- Минимальный размер клана: 5
- Высокая плотность связей: 0.7
- Результат: формируются сильные кланы, возможны конфликты

### Сценарий 4: Хаос и конфликты
- Низкий порог плотности: 0.3
- Высокая доля кражи: 100%
- Результат: множество мелких кланов, частые конфликты

## Технические детали

### Структура файлов

```
src/
├── lib/
│   ├── economicEngine.js       # Экономический движок
│   ├── clanSystem.js           # Система кланов
│   ├── conflictMechanics.js    # Конфликтная механика
│   ├── enhancedSimulation.js   # Расширенная симуляция
│   └── agentSimulation.js      # Базовая симуляция (без изменений)
├── components/
│   ├── EconomicPanel.jsx       # UI панель экономики
│   ├── ClanPanel.jsx           # UI панель кланов
│   └── ...                     # Остальные компоненты
└── App.jsx                      # Главный компонент (обновлен)
```

### Зависимости

Все компоненты используют существующие UI библиотеки:
- `./components/ui/card` - Card, CardContent, CardHeader, CardTitle, CardDescription
- `./components/ui/label` - Label
- `./components/ui/slider` - Slider
- `./components/ui/switch` - Switch
- `./components/ui/badge` - Badge
- `./components/ui/separator` - Separator
- `./components/ui/scroll-area` - ScrollArea
- `lucide-react` - иконки (Info, Users, Swords, TrendingUp)

### Производительность

- Экономические расчеты: O(n) где n - количество агентов
- Обнаружение кланов: O(n²) в худшем случае
- Конфликты: O(k) где k - количество кланов
- Рекомендуется: до 300 агентов для плавной работы

## Известные ограничения

1. Экономическая модель работает только при включенном переключателе
2. Статистика кланов обновляется только после завершения симуляции
3. Визуализация конфликтов в реальном времени не реализована
4. Экспорт экономических данных требует доработки

## Возможные улучшения

1. **Визуализация в реальном времени:**
   - Анимация конфликтов
   - График изменения ресурсов
   - Динамическое отображение кланов

2. **Расширенная аналитика:**
   - Графики выживаемости
   - Анализ эффективности правил распределения
   - Корреляция между связями и ресурсами

3. **Дополнительные механики:**
   - Торговля между агентами
   - Альянсы между кланами
   - Миграция агентов между кланами

4. **Экспорт данных:**
   - Отдельный экспорт экономической истории
   - Визуализация истории конфликтов
   - Детальные отчеты по кланам

## Заключение

Экономическая модель успешно интегрирована в Agent Network Visualizer v2.1. Все основные компоненты работают корректно:

✅ Экономический движок с производством и потреблением
✅ Система кланов с обнаружением и голосованием
✅ Конфликтная механика с поляризацией и кражей ресурсов
✅ UI панели для настройки и просмотра статистики
✅ Интеграция в основное приложение
✅ Сбор детальной статистики

Модель готова к использованию и тестированию различных социально-экономических сценариев.
